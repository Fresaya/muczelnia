<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mUczelnia - Pulpit</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- STYLE DLA MODALI I LIST --- */
        .class-edit-item { border-bottom: 1px solid var(--border-color); padding: 12px; transition: background 0.2s; }
        .class-edit-item:hover { background: var(--hover-bg); }
        .class-row-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .save-mini-btn { padding: 5px 10px; font-size: 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px; }
        .delete-mini-btn { cursor: pointer; color: var(--accent-color); font-size: 18px; margin-left: 10px; }
        
        /* CHIPY PAKIET√ìW */
        .packages-container { display: flex; flex-wrap: wrap; gap: 5px; padding-left: 2px; }
        .pkg-chip { display: inline-flex; align-items: center; background-color: rgba(33, 150, 243, 0.1); color: #1565C0; border: 1px solid rgba(33, 150, 243, 0.3); border-radius: 12px; padding: 2px 8px; font-size: 11px; font-weight: 500; }
        .pkg-chip-remove { margin-left: 6px; cursor: pointer; font-weight: bold; color: #1565C0; opacity: 0.6; font-size: 14px; line-height: 1; }
        .pkg-chip-remove:hover { opacity: 1; color: red; }

        /* --- KALENDARZ --- */
        .event-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--border-color); }
        .event-date-box { 
            background: var(--panel-bg); border: 1px solid var(--border-color); 
            border-radius: 8px; width: 50px; height: 50px; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; margin-right: 15px; box-shadow: var(--shadow);
        }
        .event-day { font-size: 18px; font-weight: bold; color: var(--text-main); }
        .event-month { font-size: 10px; text-transform: uppercase; color: var(--text-muted); }
        
        .event-details { flex: 1; }
        .event-title { font-weight: bold; font-size: 15px; color: var(--text-main); }
        .event-meta { font-size: 12px; color: var(--text-muted); }
        
        .event-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; color: #fff; font-weight: bold; margin-left: 5px; }
        .bg-test { background: #f04a4a; } /* Czerwony - Test */
        .bg-homework { background: #FF9800; } /* Pomara≈Ñczowy - Zadanie */
        .bg-info { background: #2196F3; } /* Niebieski - Info */

        /* Dark mode calendar */
        @media (prefers-color-scheme: dark) {
            .pkg-chip { background-color: rgba(33, 150, 243, 0.2); color: #90caf9; border-color: rgba(33, 150, 243, 0.5); }
            .pkg-chip-remove { color: #90caf9; }
            .event-date-box { background: #2a2a2a; border-color: #444; }
        }
    </style>
</head>
<body>

    <div class="layout-wrapper">
        <aside class="sidebar-left">
            <div class="top-section">
                <div class="brand-area"><a href="#" class="logo-text"><span>m</span>Uczelnia</a></div>
                <ul class="nav-menu">
                    <li class="nav-item"><a href="#" class="nav-link active"><span>Pulpit</span></a></li>
                </ul>
            </div>
        </aside>

        <main class="main-content">
            <div class="welcome-header">
                <div>
                    <h1 id="welcome-message">Witaj!</h1>
                    <p>Wybierz modu≈Ç, aby kontynuowaƒá.</p>
                </div>
            </div>

            <div class="dashboard-grid">
                
                <a href="admin_content.html" id="widget-admin-content" class="widget-tile" style="display: none; border: 2px solid #333;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23333%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z%22></path><polyline points=%2214 2 14 8 20 8%22></polyline><line x=%2216%22 y1=%2213%22 x2=%228%22 y2=%2213%22></line><line x=%2216%22 y1=%2217%22 x2=%228%22 y2=%2217%22></line><polyline points=%2210 9 9 9 8 9%22></polyline></svg>');"></div>
                    <h3>Baza Tre≈õci</h3>
                    <p class="course-meta">PrzeglƒÖdaj i Edytuj</p>
                </a>

                <a href="create_course.html" id="widget-create-course" class="widget-tile" style="display: none; border: 2px dashed var(--accent-color);">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23f04a4a%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><rect x=%223%22 y=%223%22 width=%2218%22 height=%2218%22 rx=%222%22 ry=%222%22></rect><line x=%2212%22 y=%228%22 x2=%2212%22 y2=%2216%22></line><line x=%228%22 y=%2212%22 x2=%2216%22 y2=%2212%22></line></svg>');"></div>
                    <h3 style="color: var(--accent-color);">Utw√≥rz Kurs</h3>
                    <p class="course-meta">Administrator</p>
                </a>

                <a href="create_quiz.html" id="widget-create-quiz" class="widget-tile" style="display: none; border: 2px dashed #9C27B0;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%239C27B0%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z%22></path><polyline points=%2214 2 14 8 20 8%22></polyline><line x=%2212%22 y=%2218%22 x2=%2212%22 y2=%2218%22></line><line x=%2212%22 y=%2214%22 x2=%2212%22 y2=%2212%22></line></svg>');"></div>
                    <h3 style="color: #9C27B0;">Utw√≥rz Quiz</h3>
                    <p class="course-meta">Administrator</p>
                </a>
                
                <div id="widget-add-user" class="widget-tile" style="display: none; border: 2px dashed #555; cursor: pointer;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23555%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2%22></path><circle cx=%228.5%22 cy=%227%22 r=%224%22></circle><line x=%2220%22 y=%2218%22 x2=%2220%22 y2=%2214%22></line><line x=%2223%22 y=%2211%22 x2=%2217%22 y2=%2211%22></line></svg>');"></div>
                    <h3 style="color: #555;">Dodaj U≈ºytkownika</h3>
                    <p class="course-meta">Admin & Manager</p>
                </div>

                <div id="widget-add-school" class="widget-tile" style="display: none; border: 2px dashed #2196F3; cursor: pointer;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%232196F3%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M3 21h18M5 21V7l8-4 8 4v14M8 21v-4h8v4%22></path></svg>');"></div>
                    <h3 style="color: #2196F3;">Dodaj Szko≈Çƒô</h3>
                    <p class="course-meta">Administrator</p>
                </div>

                <div id="widget-add-class" class="widget-tile" style="display: none; border: 2px dashed #4CAF50; cursor: pointer;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%234CAF50%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2%22></path><circle cx=%229%22 cy=%227%22 r=%224%22></circle><path d=%22M23 21v-2a4 4 0 0 0-3-3.87%22></path><path d=%22M16 3.13a4 4 0 0 1 0 7.75%22></path></svg>');"></div>
                    <h3 style="color: #4CAF50;">Dodaj Klasƒô</h3>
                    <p class="course-meta">Admin & Manager</p>
                </div>

                <div id="widget-manage-classes" class="widget-tile" style="display: none; border: 2px dashed #009688; cursor: pointer;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23009688%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7%22></path><path d=%22M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z%22></path></svg>');"></div>
                    <h3 style="color: #009688;">ZarzƒÖdzaj Klasami</h3>
                    <p class="course-meta">Edycja i Usuwanie</p>
                </div>

                <div id="widget-manage-students" class="widget-tile" style="display: none; border: 2px dashed #FF9800; cursor: pointer;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23FF9800%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2%22></path><circle cx=%229%22 cy=%227%22 r=%224%22></circle><path d=%22M23 21v-2a4 4 0 0 0-3-3.87%22></path><path d=%22M16 3.13a4 4 0 0 1 0 7.75%22></path></svg>');"></div>
                    <h3 style="color: #FF9800;">ZarzƒÖdzaj Uczniami</h3>
                    <p class="course-meta">Edycja i Usuwanie</p>
                </div>

                <div id="widget-assign-course" class="widget-tile" style="display: none; border: 2px dashed #9C27B0; cursor: pointer;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%239C27B0%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M4 19.5A2.5 2.5 0 0 1 6.5 17H20%22></path><path d=%22M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z%22></path><path d=%22M12 11h5%22></path><path d=%22M12 8h5%22></path></svg>');"></div>
                    <h3 style="color: #9C27B0;">Przypisz Materia≈Ç</h3>
                    <p class="course-meta">Dodaj pakiet do klasy</p>
                </div>
                
                <a href="teacher_results.html" id="widget-teacher-results" class="widget-tile" style="display: none; border: 2px solid #673AB7; text-decoration: none; color: inherit;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23673AB7%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z%22></path><polyline points=%2214 2 14 8 20 8%22></polyline><line x=%2216%22 y1=%2213%22 x2=%228%22 y2=%2213%22></line><line x=%2216%22 y1=%2217%22 x2=%228%22 y2=%2217%22></line><polyline points=%2210 9 9 9 8 9%22></polyline></svg>');"></div>
                    <h3 style="color: #673AB7;">Wyniki Uczni√≥w</h3>
                    <p class="course-meta">PodglƒÖd i Poprawy</p>
                </a>

                <a href="teacher_grades.html" id="widget-teacher-grades" class="widget-tile" style="display: none; border: 2px solid #FF9800; text-decoration: none; color: inherit;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23FF9800%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2%22></path><rect x=%228%22 y=%222%22 width=%228%22 height=%224%22 rx=%221%22 ry=%221%22></rect><path d=%22M9 14l2 2 4-4%22></path></svg>');"></div>
                    <h3 style="color: #FF9800;">Dziennik Ocen</h3>
                    <p class="course-meta">Wystawianie i edycja</p>
                </a>

                <div id="widget-calendar" class="widget-tile" style="cursor: pointer; border: 2px solid #2196F3;">
                    <div class="widget-icon" style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%232196F3%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><rect x=%223%22 y=%224%22 width=%2218%22 height=%2218%22 rx=%222%22 ry=%222%22></rect><line x=%2216%22 y1=%222%22 x2=%2216%22 y2=%226%22></line><line x=%228%22 y=%222%22 x2=%228%22 y2=%226%22></line><line x=%223%22 y=%2210%22 x2=%2221%22 y2=%2210%22></line></svg>');"></div>
                    <h3 style="color: #2196F3;">Terminarz</h3>
                    <p class="course-meta" id="calendar-preview">≈Åadowanie...</p>
                </div>

                <a href="courses_list.html" id="widget-student-courses" class="widget-tile">
                    <div class="widget-icon icon-course-active"></div>
                    <h3>Moje Przedmioty</h3>
                    <p class="course-meta">Przejd≈∫ do nauki</p>
                </a>

                <a href="grades.html" id="widget-student-grades" class="widget-tile">
                    <div class="widget-icon icon-grades"></div>
                    <h3>Moje Oceny</h3>
                    <p class="course-meta">Sprawd≈∫ wyniki</p>
                </a>
            </div>
        </main>

        <aside class="sidebar-right">
            <div class="profile-card">
                <div class="avatar" id="avatarTrigger" title="Kliknij, aby otworzyƒá opcje"></div>
                <div class="dropdown-menu" id="profileDropdown">
                    <div class="dropdown-item" id="logoutBtn">
                        <div class="icon-logout"></div>
                        Wyloguj siƒô
                    </div>
                </div>
                <h2 class="profile-name" id="profile-name-display">...</h2>
                <p class="profile-id" id="profile-role-display">...</p>
                <p style="font-size: 13px; color: #888; margin-top: 5px; max-width: 200px; line-height: 1.4;" id="profile-school-display"></p>
            </div>
        </aside>
    </div>

    <div class="modal-overlay" id="createUserModal">
        <div class="modal-window">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj U≈ºytkownika</h3>
                <span class="close-modal" onclick="closeModal('createUserModal')">&times;</span>
            </div>
            <form id="createUserForm" class="modal-form">
                <label>Nazwa (Imiƒô i Nazwisko)</label>
                <input type="text" id="new-username" class="edit-input" required>
                
                <label>Rola</label>
                <select id="new-role" class="edit-input" style="border:1px solid #ccc; margin-bottom: 15px;">
                    <option value="student" selected>Student</option>
                    <option value="teacher">Nauczyciel</option>
                    <option value="manager">Dziekanat (Manager)</option>
                    <option value="admin">Administrator</option>
                </select>

                <div id="school-select-container" style="display: block;">
                    <label>Typ Szko≈Çy</label>
                    <select id="new-user-level-filter" class="edit-input" style="border:1px solid #ccc; margin-bottom: 10px;">
                        <option value="" disabled selected>-- Wybierz Typ --</option>
                        <option value="1">Szko≈Ça Podstawowa</option>
                        <option value="2">Szko≈Ça ≈örednia</option>
                        <option value="3">Szko≈Ça Wy≈ºsza</option>
                    </select>

                    <label>Szko≈Ça / Wydzia≈Ç</label>
                    <select id="new-user-school" class="edit-input" style="border:1px solid #ccc; margin-bottom: 15px;" disabled>
                        <option value="" selected disabled>-- Najpierw wybierz typ --</option>
                    </select>

                    <div id="class-select-container" style="display:none;">
                        <label>Klasa (Opcjonalnie)</label>
                        <select id="new-user-class" class="edit-input" style="border:1px solid #ccc; margin-bottom: 15px;" disabled>
                            <option value="" selected disabled>-- Najpierw wybierz szko≈Çƒô --</option>
                        </select>
                    </div>
                </div>

                <div style="background: #f4f4f4; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #ddd;">
                    <label style="margin:0; font-size:12px; color:#555; text-transform:uppercase;">Login (Generowany automatycznie)</label>
                    <input type="text" id="new-email" class="edit-input" 
                           style="background:transparent; border:none; font-weight:bold; color:#333; margin:0; padding:5px 0; width:100%;" 
                           readonly placeholder="Wype≈Çnij formularz..." required>
                </div>

                <label>Has≈Ço</label>
                <input type="password" id="new-password" class="edit-input" required placeholder="Has≈Ço startowe">
                
                <button type="submit" class="login-button full-width-btn" id="createBtn">Utw√≥rz konto</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="addSchoolModal">
        <div class="modal-window">
            <div class="modal-header">
                <h3 class="modal-title">Dodaj Szko≈Çƒô</h3>
                <span class="close-modal" onclick="closeModal('addSchoolModal')">&times;</span>
            </div>
            <form id="addSchoolForm" class="modal-form">
                <label>Nazwa Szko≈Çy</label>
                <input type="text" id="school-name" class="edit-input" placeholder="np. Liceum nr 1" required>
                <label>Skr√≥t (max 5 znak√≥w)</label>
                <input type="text" id="school-abbr" class="edit-input" placeholder="LO1" maxlength="5" style="text-transform:uppercase;" required>
                <label>Poziom Szko≈Çy</label>
                <select id="school-level" class="edit-input" style="border:1px solid #ccc;" required>
                    <option value="1">Szko≈Ça Podstawowa</option>
                    <option value="2">Szko≈Ça ≈örednia</option>
                    <option value="3">Szko≈Ça Wy≈ºsza</option>
                </select>
                <label>Adres</label>
                <input type="text" id="school-address" class="edit-input">
                <button type="submit" class="login-button full-width-btn">Zapisz Szko≈Çƒô</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="addClassModal"><div class="modal-window"><div class="modal-header"><h3 class="modal-title">Dodaj Klasƒô/Grupƒô</h3><span class="close-modal" onclick="closeModal('addClassModal')">&times;</span></div><form id="addClassForm" class="modal-form"><label>Wybierz Szko≈Çƒô</label><select id="class-school-select" class="edit-input" style="border:1px solid #ccc;" required><option value="" disabled selected>≈Åadowanie szk√≥≈Ç...</option></select><label>Nazwa Klasy</label><input type="text" id="class-name" class="edit-input" placeholder="np. 1A - Informatyka" required><button type="submit" class="login-button full-width-btn">Zapisz Klasƒô</button></form></div></div>
    
    <div class="modal-overlay" id="manageStudentsModal"><div class="modal-window" style="max-width: 900px;"><div class="modal-header"><h3 class="modal-title">ZarzƒÖdzanie Uczniami</h3><span class="close-modal" onclick="closeModal('manageStudentsModal')">&times;</span></div>
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <div style="flex:1;">
                <label>Typ Szko≈Çy</label>
                <select id="manage-level-filter" class="edit-input" style="margin:0;"><option value="" disabled selected>-- Wybierz --</option><option value="1">Podst.</option><option value="2">≈örednia</option><option value="3">Wy≈ºsza</option><option value="all">Wszystkie</option></select>
            </div>
            <div id="manage-school-wrapper" style="flex: 2;">
                <label>Szko≈Ça</label>
                <select id="manage-school-select" class="edit-input" style="margin:0;"><option value="" disabled selected>Najpierw typ...</option></select>
            </div>
            <div id="manage-class-filter-wrapper" style="flex: 1; display: none;">
                <label>Filtruj klasƒô</label>
                <select id="filter-class-select" class="edit-input" style="margin:0;"><option value="all" selected>Wszyscy</option></select>
            </div>
        </div>
        <div id="students-loading" style="display:none; text-align:center;">≈Åadowanie listy...</div>
        <div id="students-table-container" style="max-height: 400px; overflow-y: auto; display: none;">
            <table class="student-table"><thead><tr><th>Imiƒô i Nazwisko</th><th>Login</th><th>Klasa</th><th>Akcje</th></tr></thead><tbody id="students-table-body"></tbody></table>
            <p id="no-students-msg" style="text-align:center; color:#888; display:none; padding:20px;">Brak student√≥w.</p>
        </div></div></div>
    
    <div class="modal-overlay" id="assignCourseModal"><div class="modal-window"><div class="modal-header"><h3 class="modal-title">Przypisz Pakiet do Klasy</h3><span class="close-modal" onclick="closeModal('assignCourseModal')">&times;</span></div><form id="assignCourseForm" class="modal-form"><div style="margin-bottom: 10px;">
        <label>1. Wybierz Szko≈Çƒô</label><select id="assign-school-select" class="edit-input" style="border:1px solid #ccc; margin-bottom:10px;"><option value="">-- Wybierz --</option></select>
        <label>2. Wybierz Klasƒô</label><select id="assign-class-select" class="edit-input" style="border:1px solid #ccc; margin-bottom:10px;" disabled><option value="">-- Wybierz szko≈Çƒô najpierw --</option></select>
        <label>3. Wybierz Pakiet</label><select id="assign-package-select" class="edit-input" style="border:1px solid #ccc;" required><option value="" disabled selected>-- Wybierz Pakiet --</option></select>
    </div><button type="submit" class="login-button full-width-btn">Przypisz Pakiet</button></form></div></div>

    <div class="modal-overlay" id="manageClassesModal">
        <div class="modal-window" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Edycja Klas</h3>
                <span class="close-modal" onclick="closeModal('manageClassesModal')">&times;</span>
            </div>
            <label>Wybierz Szko≈Çƒô, aby edytowaƒá klasy:</label>
            <select id="manage-class-school-select" class="edit-input" style="border:1px solid #ccc; margin-bottom:20px;">
                <option value="">≈Åadowanie szk√≥≈Ç...</option>
            </select>
            <div id="classes-list-container" style="max-height: 400px; overflow-y: auto;">
                <p style="color:#888; text-align:center;">Wybierz szko≈Çƒô, aby zobaczyƒá listƒô.</p>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="calendarModal">
        <div class="modal-window" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Terminarz</h3>
                <span class="close-modal" onclick="closeModal('calendarModal')">&times;</span>
            </div>
            
            <div id="calendar-teacher-tools" style="display:none; background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #eee;">
                <h4 style="margin:0 0 10px 0; font-size:14px;">Dodaj Wydarzenie</h4>
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                    <select id="cal-class" class="edit-input" style="flex:1; min-width:150px;"><option>Wybierz klasƒô...</option></select>
                    <input type="date" id="cal-date" class="edit-input" style="width:140px;">
                    <select id="cal-type" class="edit-input" style="width:120px;">
                        <option value="test">Sprawdzian</option>
                        <option value="homework">Zadanie</option>
                        <option value="info">Info</option>
                    </select>
                </div>
                <input type="text" id="cal-title" class="edit-input" placeholder="Tytu≈Ç (np. Test z Historii)" style="margin-top:10px;">
                <button class="login-button full-width-btn" style="margin-top:10px;" onclick="addCalendarEvent()">Dodaj do kalendarza</button>
            </div>

            <div id="calendar-events-list" style="max-height: 400px; overflow-y: auto;">
                <p style="text-align:center; color:#888;">≈Åadowanie wydarze≈Ñ...</p>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://xzbonbdtfgrhihwmiamq.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6Ym9uYmR0ZmdyaGlod21pYW1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxNDYxMzAsImV4cCI6MjA3OTcyMjEzMH0.iqd1FO3kdgECw857Okf0CF_i570wcTk2VtJhJXSwlEg'; 
        // G≈Ç√≥wny klient (utrzymuje sesjƒô Admina/Nauczyciela)
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        let currentUserRole = null;
        let currentUserSchoolId = null;
        let currentUserClassId = null;
        let schoolsCache = [];
        let generatedMemberCode = null;

        document.addEventListener('DOMContentLoaded', async () => {
            const { data: { session } } = await _supabase.auth.getSession();
            if (!session) { window.location.href = 'login.html'; return; }

            const userId = session.user.id;
            const { data: profile } = await _supabase.from('users').select('username, role, school_id, class_id, schools(name), classes(name)').eq('id', userId).single();

            if (profile) {
                currentUserRole = profile.role;
                currentUserSchoolId = profile.school_id;
                currentUserClassId = profile.class_id;
                
                document.getElementById('profile-name-display').textContent = profile.username;
                const roleMap = { 'student': 'UCZE≈É', 'teacher': 'NAUCZYCIEL', 'manager': 'DZIEKANAT', 'admin': 'ADMIN' };
                document.getElementById('profile-role-display').textContent = (roleMap[profile.role] || profile.role).toUpperCase();
                
                let schoolInfo = "";
                if (profile.schools && profile.schools.name) schoolInfo = profile.schools.name;
                if (profile.classes && profile.classes.name) schoolInfo += `<br><span style="color:var(--accent-color); font-weight:bold;">${profile.classes.name}</span>`;
                document.getElementById('profile-school-display').innerHTML = schoolInfo;
                document.getElementById('welcome-message').textContent = `Witaj, ${profile.username}!`;

                // --- WIDOCZNO≈öƒÜ WIDGET√ìW ---
                if (['admin', 'manager', 'teacher'].includes(currentUserRole)) {
                    show('widget-assign-course');
                    show('widget-teacher-results');
                    show('widget-teacher-grades');
                    document.getElementById('widget-assign-course').onclick = () => openAssignCourseModal();
                }

                if (currentUserRole === 'admin') {
                    ['widget-admin-content', 'widget-create-course', 'widget-create-quiz', 'widget-add-user', 'widget-add-school', 'widget-add-class', 'widget-manage-students', 'widget-manage-classes'].forEach(show);
                    ['widget-student-courses', 'widget-student-grades'].forEach(hide);
                    
                    document.getElementById('widget-add-user').onclick = () => openCreateUserModal();
                    document.getElementById('widget-add-school').onclick = () => openModal('addSchoolModal');
                    document.getElementById('widget-add-class').onclick = () => openClassModal();
                    document.getElementById('widget-manage-students').onclick = () => openManageStudentsModal();
                    document.getElementById('widget-manage-classes').onclick = () => openManageClassesModal();
                }

                if (currentUserRole === 'manager') {
                    show('widget-add-user');
                    show('widget-add-class');
                    show('widget-manage-students');
                    show('widget-manage-classes');
                    document.getElementById('widget-add-user').onclick = () => openCreateUserModal();
                    document.getElementById('widget-add-class').onclick = () => openClassModal();
                    document.getElementById('widget-manage-students').onclick = () => openManageStudentsModal();
                    document.getElementById('widget-manage-classes').onclick = () => openManageClassesModal();
                }

                // INICJALIZACJA KALENDARZA
                loadCalendarPreview();
                document.getElementById('widget-calendar').onclick = () => openCalendarModal();
            }

            // Listenery (Menu, Wylogowanie)
            document.getElementById('avatarTrigger').addEventListener('click', (e) => { e.stopPropagation(); document.getElementById('profileDropdown').classList.toggle('show'); });
            window.addEventListener('click', () => document.getElementById('profileDropdown').classList.remove('show'));
            document.getElementById('logoutBtn').addEventListener('click', async () => { await _supabase.auth.signOut(); window.location.href = 'login.html'; });

            // Listenery Formularzy
            document.getElementById('createUserForm').addEventListener('submit', createNewUser);
            document.getElementById('addSchoolForm').addEventListener('submit', addSchool);
            document.getElementById('addClassForm').addEventListener('submit', addClass);
            document.getElementById('assignCourseForm').addEventListener('submit', assignCourseToClass);
            
            // Listenery Filtr√≥w
            document.getElementById('new-role').addEventListener('change', handleRoleChange);
            document.getElementById('new-user-level-filter').addEventListener('change', filterNewUserSchools);
            document.getElementById('new-user-school').addEventListener('change', async function() { await loadClassesForSchool(this.value); generateEmail(); });
            document.getElementById('new-user-class').addEventListener('change', generateEmail);

            // Listenery ZarzƒÖdzania Uczniami
            document.getElementById('manage-level-filter').addEventListener('change', filterManageStudentSchools);
            document.getElementById('manage-school-select').addEventListener('change', function() { loadStudentsForSchool(this.value); });
            document.getElementById('filter-class-select').addEventListener('change', filterStudentsTable);
            
            // Listenery ZarzƒÖdzania Klasami
            document.getElementById('manage-class-school-select').addEventListener('change', function() { loadClassesForEdit(this.value); });

            // Listener Przypisywania Pakietu
            document.getElementById('assign-school-select').addEventListener('change', async function() {
                const sid = parseInt(this.value); 
                const cSelect = document.getElementById('assign-class-select');
                cSelect.disabled = true; cSelect.innerHTML = '<option>≈Åadowanie...</option>';
                const { data } = await _supabase.from('classes').select('id, name').eq('school_id', sid).order('name');
                cSelect.innerHTML = '<option value="" disabled selected>-- Wybierz Klasƒô --</option>';
                if (data && data.length > 0) { data.forEach(c => cSelect.add(new Option(c.name, c.id))); cSelect.disabled = false; }
                else { cSelect.innerHTML = '<option value="" disabled selected>Brak klas</option>'; }
            });
        });

        // --- FUNKCJE POMOCNICZE ---
        function show(id) { const el=document.getElementById(id); if(el)el.style.display='flex'; }
        function hide(id) { const el=document.getElementById(id); if(el)el.style.display='none'; }
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        async function ensureSchoolsCache() {
            if (schoolsCache.length === 0) {
                const { data } = await _supabase.from('schools').select('id, name, level, abbreviation');
                schoolsCache = data || [];
            }
        }

        // --- TWORZENIE U≈ªYTKOWNIKA (POPRAWKA: BRAK PRZELOGOWANIA) ---
        async function openCreateUserModal() {
            openModal('createUserModal');
            await ensureSchoolsCache();
            document.getElementById('new-user-level-filter').value = "";
            const sSelect = document.getElementById('new-user-school');
            sSelect.innerHTML = '<option value="" disabled selected>-- Wybierz typ najpierw --</option>';
            sSelect.disabled = true;
            document.getElementById('class-select-container').style.display = 'none';
            document.getElementById('new-email').value = "";
            document.getElementById('new-password').value = "";
            document.getElementById('new-username').value = "";
        }

        function handleRoleChange() {
            const role = document.getElementById('new-role').value;
            const sc = document.getElementById('school-select-container');
            const cc = document.getElementById('class-select-container');
            const em = document.getElementById('new-email');
            if (role === 'admin') { 
                sc.style.display = 'none'; em.removeAttribute('readonly'); em.value = ""; em.placeholder = "Email admina"; 
            } else { 
                sc.style.display = 'block'; em.setAttribute('readonly', true); em.placeholder = "Wybierz szko≈Çƒô..."; 
                cc.style.display = (role === 'student') ? 'block' : 'none'; 
                if(document.getElementById('new-user-school').value) generateEmail();
            }
        }

        function filterNewUserSchools() {
            const lvl = document.getElementById('new-user-level-filter').value;
            const s = document.getElementById('new-user-school');
            s.innerHTML = '<option value="" disabled selected>-- Wybierz --</option>';
            schoolsCache.filter(x => x.level == lvl).forEach(x => s.add(new Option(x.name, x.id)));
            s.disabled = false;
        }

        async function loadClassesForSchool(sid) {
            const c = document.getElementById('new-user-class');
            c.innerHTML = '<option>...</option>'; c.disabled = true;
            const { data } = await _supabase.from('classes').select('id, name').eq('school_id', sid);
            c.innerHTML = '<option value="">-- Brak --</option>';
            if(data) data.forEach(x => c.add(new Option(x.name, x.id)));
            c.disabled = false;
        }

        async function generateEmail() {
            const r = document.getElementById('new-role').value;
            const sid = document.getElementById('new-user-school').value;
            const em = document.getElementById('new-email');
            if(r==='admin'||!sid)return;
            em.value="...";
            const s=schoolsCache.find(x=>x.id==sid);
            const abbr=s?s.abbreviation:"SC";
            const {count}=await _supabase.from('users').select('*',{count:'exact',head:true}).eq('school_id',sid).eq('role',r);
            const n=(count||0)+1;
            generatedMemberCode=n;
            em.value = `${String(n).padStart(4,'0')}.${abbr}-${r==='student'?'student':'kadra'}@muczelnia.pl`;
        }

        async function createNewUser(e) {
            e.preventDefault();
            const btn = document.getElementById('createBtn');
            btn.disabled = true; btn.textContent = "Tworzenie...";
            
            const email = document.getElementById('new-email').value;
            const password = document.getElementById('new-password').value;
            const username = document.getElementById('new-username').value;
            const role = document.getElementById('new-role').value;
            const schoolId = document.getElementById('new-user-school').value;
            const classId = document.getElementById('new-user-class').value || null;

            // FIX: U≈ºywamy NOWEGO klienta z wy≈ÇƒÖczonym persistSession
            // To zapobiega nadpisaniu sesji Admina w localStorage
            const tempClient = supabase.createClient(supabaseUrl, supabaseKey, {
                auth: {
                    persistSession: false,
                    autoRefreshToken: false,
                    detectSessionInUrl: false
                }
            });

            const { error } = await tempClient.auth.signUp({
                email: email, 
                password: password,
                options: { 
                    data: { 
                        username: username, 
                        role: role, 
                        school_id: schoolId || null, 
                        class_id: classId, 
                        member_code: generatedMemberCode 
                    } 
                }
            });

            if (error) {
                alert("B≈ÇƒÖd: " + error.message);
            } else {
                alert(`‚úÖ Utworzono konto: ${email}`);
                closeModal('createUserModal');
                document.getElementById('createUserForm').reset();
            }
            btn.disabled = false; btn.textContent = "Utw√≥rz konto";
        }

        // --- ZARZƒÑDZANIE SZKO≈ÅAMI I KLASAMI (MODALE) ---
        async function addSchool(e){ e.preventDefault(); const {error}=await _supabase.from('schools').insert({name:document.getElementById('school-name').value, abbreviation:document.getElementById('school-abbr').value, level:document.getElementById('school-level').value, address:document.getElementById('school-address').value}); if(error)alert(error.message); else {alert("Dodano"); closeModal('addSchoolModal'); schoolsCache=[];} }
        async function openClassModal(){ openModal('addClassModal'); const s=document.getElementById('class-school-select'); const {data}=await _supabase.from('schools').select('id,name'); s.innerHTML='<option value="">Wybiez</option>'; data.forEach(x=>s.add(new Option(x.name,x.id))); }
        async function addClass(e){ e.preventDefault(); const {error}=await _supabase.from('classes').insert({school_id:document.getElementById('class-school-select').value, name:document.getElementById('class-name').value}); if(error)alert(error.message); else {alert("Dodano"); closeModal('addClassModal');} }
        
        // --- ZARZƒÑDZANIE UCZNIAMI (POPRAWKA: RESET WIDOKU) ---
        async function openManageStudentsModal(){ 
            openModal('manageStudentsModal'); 
            await ensureSchoolsCache(); 
            
            // RESET P√ìL FILTR√ìW
            document.getElementById('manage-level-filter').value = "";
            document.getElementById('manage-school-select').innerHTML = '<option value="" disabled selected>Najpierw typ...</option>';
            document.getElementById('filter-class-select').innerHTML = '<option value="all">Wszyscy</option>';
            
            // RESET TABELI (CZY≈öCIMY DANE POPRZEDNIEJ SZKO≈ÅY)
            document.getElementById('students-table-body').innerHTML = '';
            document.getElementById('students-table-container').style.display = 'none';
            document.getElementById('no-students-msg').style.display = 'none';
            document.getElementById('students-loading').style.display = 'none';
        }

        function filterManageStudentSchools(){ const lvl=document.getElementById('manage-level-filter').value; const s=document.getElementById('manage-school-select'); s.innerHTML='<option disabled selected>Wybierz</option>'; schoolsCache.filter(x=>x.level==lvl).forEach(x=>s.add(new Option(x.name,x.id))); }
        
        async function loadStudentsForSchool(sid){ 
            const tb=document.getElementById('students-table-body'); 
            const l=document.getElementById('students-loading'); 
            const c=document.getElementById('students-table-container'); 
            const f=document.getElementById('filter-class-select'); 
            
            l.style.display='block'; c.style.display='none'; tb.innerHTML=''; 
            
            const {data:st}=await _supabase.from('users').select('id,username,email,class_id').eq('school_id',sid).eq('role','student'); 
            const {data:cls}=await _supabase.from('classes').select('id,name').eq('school_id',sid); 
            
            f.innerHTML='<option value="all">Wszyscy</option>'; 
            if(cls) cls.forEach(x=>f.add(new Option(x.name,x.id))); 
            
            l.style.display='none'; c.style.display='block'; 
            
            if(!st||st.length===0){document.getElementById('no-students-msg').style.display='block';return;} 
            document.getElementById('no-students-msg').style.display='none'; 
            
            st.forEach(s=>{ 
                const tr=document.createElement('tr'); tr.dataset.classId=s.class_id||'none'; 
                const sel=document.createElement('select'); sel.className='class-select-small'; 
                sel.add(new Option('--','')); 
                if(cls) cls.forEach(x=>{const o=new Option(x.name,x.id); if(s.class_id===x.id)o.selected=true; sel.add(o);}); 
                
                const tdA=document.createElement('td'); 
                const bS=document.createElement('button'); bS.textContent='üíæ'; bS.className='action-icon'; bS.style.background='transparent'; bS.style.border='none'; 
                bS.onclick=async()=>{const v=sel.value?parseInt(sel.value):null; await _supabase.from('users').update({class_id:v}).eq('id',s.id); tr.dataset.classId=v||'none'; alert("Zapisano");}; 
                
                const bD=document.createElement('span'); bD.textContent='‚ùå'; bD.className='action-icon'; bD.style.color='red'; 
                bD.onclick=async()=>{if(confirm("UsunƒÖƒá?")){await _supabase.from('users').delete().eq('id',s.id); tr.remove();}}; 
                
                tdA.append(bS,bD); 
                tr.innerHTML=`<td><b>${s.username}</b></td><td>${s.email}</td>`; 
                const tdC=document.createElement('td'); tdC.appendChild(sel); 
                tr.append(tdC,tdA); tb.appendChild(tr); 
            }); 
        }

        function filterStudentsTable(){ const v=document.getElementById('filter-class-select').value; document.querySelectorAll('#students-table-body tr').forEach(r=>{ const cid=r.dataset.classId; if(v==='all'||(v==='none'&&(!cid||cid==='none'))||cid==v) r.style.display=''; else r.style.display='none'; }); }

        // --- ZARZƒÑDZANIE KLASAMI (EDYCJA + CHIPY) ---
        async function openManageClassesModal() { openModal('manageClassesModal'); const s=document.getElementById('manage-class-school-select'); document.getElementById('classes-list-container').innerHTML=''; const {data}=await _supabase.from('schools').select('id,name').order('name'); s.innerHTML='<option value="" disabled selected>-- Wybierz --</option>'; data.forEach(x=>s.add(new Option(x.name,x.id))); }
        async function loadClassesForEdit(sid) { const c=document.getElementById('classes-list-container'); c.innerHTML='≈Åadowanie...'; const {data:cl,error}=await _supabase.from('classes').select('id,name,package_classes(id,packages(title))').eq('school_id',sid).order('name'); c.innerHTML=''; if(error)return; if(!cl||cl.length===0){c.innerHTML='Brak klas.';return;} cl.forEach(x=>{ const w=document.createElement('div'); w.className='class-edit-item'; const h=document.createElement('div'); h.className='class-row-header'; const i=document.createElement('input'); i.type='text'; i.value=x.name; i.className='edit-input'; i.style.margin='0'; i.style.width='60%'; const a=document.createElement('div'); const bS=document.createElement('button'); bS.textContent='Zapisz'; bS.className='save-mini-btn'; bS.onclick=async()=>{await _supabase.from('classes').update({name:i.value}).eq('id',x.id); alert("OK");}; const bD=document.createElement('span'); bD.textContent='üóëÔ∏è'; bD.className='delete-mini-btn'; bD.onclick=async()=>{if(confirm("UsunƒÖƒá?")){await _supabase.from('classes').delete().eq('id',x.id); w.remove();}}; a.append(bS,bD); h.append(i,a); const pC=document.createElement('div'); pC.className='packages-container'; if(x.package_classes&&x.package_classes.length>0){x.package_classes.forEach(pc=>{if(pc.packages){const ch=document.createElement('div'); ch.className='pkg-chip'; ch.innerHTML=`üì¶ ${pc.packages.title} <span class="pkg-chip-remove" onclick="unlinkPkg(${pc.id},this)">√ó</span>`; pC.appendChild(ch);}});} else {pC.innerHTML='<small style="color:#888">Brak pakiet√≥w</small>';} w.append(h,pC); c.appendChild(w); }); }
        async function unlinkPkg(id,el){if(confirm("OdpiƒÖƒá?")){await _supabase.from('package_classes').delete().eq('id',id); el.parentElement.remove();}}

        // --- PRZYPISYWANIE PAKIETU ---
        async function openAssignCourseModal(){ openModal('assignCourseModal'); const {data:s}=await _supabase.from('schools').select('id,name'); const ss=document.getElementById('assign-school-select'); ss.innerHTML='<option disabled selected>Wybierz</option>'; s.forEach(x=>ss.add(new Option(x.name,x.id))); const {data:p}=await _supabase.from('packages').select('id,title'); const ps=document.getElementById('assign-package-select'); ps.innerHTML='<option disabled selected>Wybierz</option>'; p.forEach(x=>ps.add(new Option(x.title,x.id))); }
        async function assignCourseToClass(e){ e.preventDefault(); const p=document.getElementById('assign-package-select').value; const c=document.getElementById('assign-class-select').value; if(!c)return alert("Klasa!"); const {error}=await _supabase.from('package_classes').insert({package_id:p,class_id:c}); if(error)alert(error.message); else{alert("Przypisano"); closeModal('assignCourseModal');} }

        // --- KALENDARZ (BEZ ZMIAN) ---
        async function loadCalendarPreview() {
            const preview = document.getElementById('calendar-preview');
            if(['admin', 'teacher', 'manager'].includes(currentUserRole)) { preview.innerHTML = "ZarzƒÖdzaj terminami"; return; }
            if(!currentUserClassId) { preview.innerHTML = "Brak klasy"; return; }
            const today = new Date().toISOString().split('T')[0];
            const { data } = await _supabase.from('calendar_events').select('title, event_date').eq('class_id', currentUserClassId).gte('event_date', today).order('event_date', { ascending: true }).limit(1).single();
            if(data) { const d = new Date(data.event_date); const day = d.getDate()<10?'0'+d.getDate():d.getDate(); const month = d.getMonth()+1<10?'0'+(d.getMonth()+1):d.getMonth()+1; preview.innerHTML = `<span style="color:var(--accent-color); font-weight:bold;">${day}.${month}</span> - ${data.title}`; } else { preview.innerHTML = "Brak wydarze≈Ñ"; }
        }
        async function openCalendarModal() { openModal('calendarModal'); const list=document.getElementById('calendar-events-list'); const tools=document.getElementById('calendar-teacher-tools'); list.innerHTML='≈Åadowanie...'; if(['admin', 'teacher', 'manager'].includes(currentUserRole)) { tools.style.display='block'; const sel=document.getElementById('cal-class'); if(sel.options.length<=1){const {data}=await _supabase.from('classes').select('id,name').eq('school_id',currentUserSchoolId).order('name');if(data)data.forEach(c=>sel.add(new Option(c.name,c.id)));} loadFullCalendar(true); } else { tools.style.display='none'; loadFullCalendar(false); } }
        async function loadFullCalendar(isTeacher) { const list=document.getElementById('calendar-events-list'); let q=_supabase.from('calendar_events').select('*').order('event_date',{ascending:true}); if(!isTeacher){const t=new Date().toISOString().split('T')[0]; q=q.gte('event_date',t);} const {data:ev}=await q; list.innerHTML=''; if(!ev||ev.length===0){list.innerHTML='<p style="text-align:center; color:#888;">Brak.</p>';return;} const mm=["ST","LUT","MAR","KWI","MAJ","CZE","LIP","SIE","WRZ","PA≈π","LIS","GRU"]; const tm={'test':'Sprawdzian','homework':'Zadanie','info':'Info'}; const tc={'test':'bg-test','homework':'bg-homework','info':'bg-info'}; ev.forEach(e=>{ const d=new Date(e.event_date); const div=document.createElement('div'); div.className='event-item'; div.innerHTML=`<div class="event-date-box"><span class="event-day">${d.getDate()}</span><span class="event-month">${mm[d.getMonth()]}</span></div><div class="event-details"><div class="event-title">${e.title}<span class="event-badge ${tc[e.type]}">${tm[e.type]}</span></div><div class="event-meta">${isTeacher?`ID Klasy: ${e.class_id}`:''}</div></div>${isTeacher?`<div class="delete-mini-btn" onclick="deleteCalendarEvent(${e.id})">&times;</div>`:''}`; list.appendChild(div); }); }
        async function addCalendarEvent() { const cid=document.getElementById('cal-class').value; const d=document.getElementById('cal-date').value; const t=document.getElementById('cal-type').value; const tit=document.getElementById('cal-title').value; if(!cid||!d||!tit)return alert("Wype≈Çnij!"); const {data:{session}}=await _supabase.auth.getSession(); const {error}=await _supabase.from('calendar_events').insert({teacher_id:session.user.id,class_id:cid,title:tit,event_date:d,type:t}); if(error)alert(error.message); else{document.getElementById('cal-title').value=""; loadFullCalendar(true);} }
        async function deleteCalendarEvent(id) { if(!confirm("UsunƒÖƒá?"))return; await _supabase.from('calendar_events').delete().eq('id',id); loadFullCalendar(true); }
    </script>
</body>
</html>

