<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mUczelnia - Pulpit_2020</title>
    <link rel="stylesheet" href="style.css">
   
</head>
<body>

    <div class="layout-wrapper">
        <aside class="sidebar-left">
            <div class="top-section">
                <div class="brand-area"><a href="#" class="logo-text"><span>m</span>Uczelnia</a></div>
                <ul class="nav-menu">
                    <li class="nav-item"><a href="#" class="nav-link active"><span>Pulpit</span></a></li>
                </ul>
            </div>
            </aside>

        <main class="main-content">
            <div class="welcome-header">
                <div>
                    <h1 id="welcome-message">Witaj!</h1>
                    <p>Wybierz moduł, aby kontynuować.</p>
                </div>
            </div>

            <div class="dashboard-grid">
                
                <a href="courses_list.html" class="widget-tile">
                    <div class="widget-icon icon-course-active"></div>
                    <h3>Moje Kursy</h3>
                    <p class="course-meta">Przejdź do listy zajęć</p>
                </a>

                <a href="#" class="widget-tile" onclick="alert('Moduł ćwiczeń w budowie!')">
                    <div class="widget-icon icon-notes"></div>
                    <h3>Ćwiczenia</h3>
                    <p class="course-meta">Testy i Quizy</p>
                </a>

                <a href="#" class="widget-tile">
                    <div class="widget-icon icon-calendar"></div>
                    <h3>Kalendarz</h3>
                </a>

                <a href="#" class="widget-tile">
                    <div class="widget-icon icon-grades"></div>
                    <h3>Oceny</h3>
                </a>

                <a href="#" class="widget-tile">
                    <div class="widget-icon icon-notes"></div>
                    <h3>Notatki</h3>
                </a>

            </div>
        </main>

        <aside class="sidebar-right">
            <div class="profile-card">
                <div class="avatar" id="avatarTrigger" title="Kliknij, aby otworzyć opcje"></div>
                
                <div class="dropdown-menu" id="profileDropdown">
                    <div class="dropdown-item" id="logoutBtn">
                        <div class="icon-logout"></div>
                        Wyloguj się
                    </div>
                </div>

                <h2 class="profile-name" id="profile-name-display">...</h2>
                <p class="profile-id" id="profile-role-display">...</p>
            </div>
        </aside>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://xzbonbdtfgrhihwmiamq.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6Ym9uYmR0ZmdyaGlod21pYW1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxNDYxMzAsImV4cCI6MjA3OTcyMjEzMH0.iqd1FO3kdgECw857Okf0CF_i570wcTk2VtJhJXSwlEg'; 
        
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        document.addEventListener('DOMContentLoaded', async () => {
            const { data: { session } } = await _supabase.auth.getSession();
            if (!session) { window.location.href = 'login.html'; return; }

            const userId = session.user.id;
            
            // Just fetch profile info
            const { data: profile } = await _supabase
                .from('users')
                .select('username, role')
                .eq('id', userId)
                .single();

            if (profile) {
                document.getElementById('profile-name-display').textContent = profile.username;
                document.getElementById('profile-role-display').textContent = profile.role.toUpperCase();
                document.getElementById('welcome-message').textContent = `Witaj, ${profile.username}!`;
            }

            // --- LOGOUT & DROPDOWN LOGIC ---
            const avatarTrigger = document.getElementById('avatarTrigger');
            const dropdown = document.getElementById('profileDropdown');
            const logoutBtn = document.getElementById('logoutBtn');

            // Toggle menu
            avatarTrigger.addEventListener('click', (e) => {
                e.stopPropagation(); // Stop click from bubbling to window
                dropdown.classList.toggle('show');
            });

            // Close menu when clicking outside
            window.addEventListener('click', () => {
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            });

            // Handle Logout
            logoutBtn.addEventListener('click', async () => {
                await _supabase.auth.signOut();
                window.location.href = 'login.html';
            });
        });
    </script>
</body>
</html>



